<?php

use Drupal\node\Entity\Node;

/**
 * Implements hook_theme().
 */
function audiodescription_theme($existing, $type, $theme, $path)
{
  return [
    'homepage' => [
      'render element' => 'children',
      'template' => 'homepage',
      'path' => $path . '/templates',
      'variables' => [
        'header' => null,
        'infos' => null,
        'about' => null,
        'highlighted_collections' => null,
        'collections' => null,
      ],
    ],
    'hp_highlighted_collections_block' => [
      'render element' => 'children',
      'template' => 'hp-highlighted-collections-block',
      'path' => $path . '/templates',
      'variables' => [
        'collections' => null,
      ],
    ],
    'hp_collections_block' => [
      'render element' => 'children',
      'template' => 'hp-collections-block',
      'path' => $path . '/templates',
      'variables' => [
        'collections' => null,
        'collection_genres' => null,
        'title' => null
      ],
    ],
    'movies_contact_block' => [
      'render element' => 'children',
      'template' => 'movies-contact-block',
      'path' => $path . '/templates',
      'variables' => [
        'title' => null,
        'description' => null,
        'email' => null,
      ],
    ],
    'search_contact_block' => [
      'render element' => 'children',
      'template' => 'search-contact-block',
      'path' => $path . '/templates',
      'variables' => [
        'title' => null,
        'description' => null,
        'cta' => null,
      ],
    ],
    'poc_movie' => [
      'render element' => 'children',
      'template' => 'poc-movie',
      'path' => $path . '/templates/poc',
      'variables' => [
        'node' => null,
        'config' => null,
        'block_contact' => null,
      ],
    ],
    'poc_search' => [
      'render element' => 'children',
      'template' => 'poc-search',
      'path' => $path . '/templates/poc',
      'variables' => [
        'has_ad' => null,
        'no_ad' => null,
        'form' => null,
      ],
    ],
    'header_search_form_block' => [
      'render element' => 'children',
      'template' => 'header-search-form-block',
      'path' => $path . '/templates',
      'variables' => [
        'form' => null,
      ],
    ],
  ];
}

function audiodescription_node_presave(Node $node) {
  $pathauto_service = \Drupal::service('pathauto.alias_cleaner');

  if ($node->getType() === 'movie') {
    $title = $node->getTitle();
    $clean_title = $pathauto_service->cleanString($title);
    $node->set('field_clean_title', $clean_title);
  }
}
