# TF1+

## Informations générales
* **Format :** API
* **URL :** Variable d'environnement `TF1_API_URL`
* **Authentification :** HTTP Basic Auth (`TF1_API_USER` / `TF1_API_PASSWORD`)
* **Fréquence d'appel :** Quotidienne

## Paramètres

L'API TF1 retourne directement la liste des films audiodécrits disponibles. Aucun paramètre de filtrage n'est nécessaire côté client.

---

## Structure de la réponse

```json
[
  {
    "id": "",
    "title": "",
    "synopsis": "",
    "productionYear": "",
    "duration": 90,
    "public": "10A",
    "poster": "https://.jpg",
    "castings": [
      {
        "job": {
          "type": "Acteur"
        },
        "persons": [
          {
            "firstName": "",
            "lastName": "",
            "role": ""
          }
        ]
      },
      {
        "job": {
          "type": "Réalisateur"
        },
        "persons": [
          {
            "firstName": "",
            "lastName": ""
          }
        ]
      }
    ],
    "externalIds": {
      "imdb": "",
      "plurimedia": ""
    },
    "genres": [
      ""
    ],
    "link": "",
    "offers": [
      {
        "type": "free",
        "price": "0",
        "startDate": "",
        "endDate": ""
      }
    ]
  }
]
```

## Mapping des champs
| Donnée                                 | Champ                              | Format   | Commentaire                                           |
|----------------------------------------|------------------------------------|----------|-------------------------------------------------------|
| ID TF1                                 | `['id']`                           | string   | Identifiant unique du programme TF1                   |
| Titre                                  | `['title']`                        | string   |                                                       |
| Synopsis                               | `['synopsis']`                     | string   |                                                       |
| Année de production                    | `['productionYear']`               | int      |                                                       |
| Genres                                 | `['genres']`                       | array    |                                                       |
| Date de début de droits d'exploitation | `['offers'][0]['startDate']`       | datetime |                                                       |
| Date de fin de droits d'exploitation   | `['offers'][0]['endDate']`         | datetime |                                                       |
| Lien                                   | `['link']`                         | string   | URL de visionnage sur TF1+                            |
| Réalisateurs                           | `['castings']`                     | array    | Objets avec `job.type = "Réalisateur"` et `persons[]` |
| Acteurs                                | `['castings']`                     | array    | Objets avec `job.type = "Acteur"` et `persons[]`      |
| Durée                                  | `['duration']`                     | int      | Durée en minutes                                      |
| Affiche (poster)                       | `['poster']`                       | string   | URL de l'affiche                                      |
| ID IMDB                                | `['externalIds']['imdb']`          | string   |                                                       |
| ID Plurimedia                          | `['externalIds']['plurimedia']`    | string   |                                                       |

### Structure du casting

```json
{
  "castings": [
    {
      "job": {
        "type": "Acteur"
      },
      "persons": [
        {
          "firstName": "",
          "lastName": "",
          "role": ""
        }
      ]
    },
    {
      "job": {
        "type": "Réalisateur"
      },
      "persons": [
        {
          "firstName": "",
          "lastName": ""
        }
      ]
    }
  ]
}
```

## Commande d'import

```bash
bin/console ad:import:tf1-api
bin/console ad:import:tf1-api --create-movies=true
```

### Options
| Option            | Valeur par défaut | Description                                      |
|-------------------|-------------------|--------------------------------------------------|
| `--create-movies` | `false`           | Si `true`, crée les films dans la table Movie    |

## Fichier source

`patrimony/src/Importer/Movie/Tf1ApiImporter.php`
